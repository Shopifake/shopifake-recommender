docker build -t fastapi-template .
docker run -d -p 8000:8000 \
# Shopifake Recommender

FastAPI microservice powering the future RAG-based recommendation engine for Shopifake. For now it exposes a contract that the catalog service can call when a product is created or updated and logs the payload for downstream processing.

## ğŸš€ Features

- FastAPI 0.116.2 served through Gunicorn+Uvicorn workers
- Qdrant health monitoring to validate the vector store dependency
- Product registration endpoint with strict Pydantic schemas and an in-memory registry
- Debug-only decoder and encoder routes to validate LLM + embedding credentials
- End-to-end tests (pytest + httpx async fixtures)
- Ruff + Black enforced via CI workflows

## ğŸƒ Quick Start

```bash
cp .env.example.dev .env
# Fill in OPENAI_API_KEY plus the decoder (`OPENAI_MODEL`) and encoder (`OPENAI_EMBEDDING_MODEL`) names
pip install -r requirements.txt
uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
```

Or spin up the full stack (app + Qdrant):

```bash
docker compose up -d --build
```

API surface:

- `GET /` â€“ Basic heartbeat
- `GET /health` â€“ Reports app status + Qdrant connectivity
- `POST /products/register` â€“ Primary contract used by the catalog service
- `POST /debug/decoder` â€“ Fire a completion against the configured decoder (non-prod)
- `POST /debug/encoder` â€“ Generate embeddings against the configured encoder (non-prod)

See autogenerated docs at http://localhost:8000/docs

## ğŸ“¦ Product registration contract

```json
{
  "product_id": "string",
  "site_id": "string",
  "name": "string",
  "description": "string",
  "images": ["https://..."],
  "categories": [{"id": "string", "site_id": "string", "name": "string"}],
  "sku": "string",
  "status": "PUBLISHED",
  "price": 199.99,
  "filters": [{"id": "string", "name": "string", "value": "string"}],
  "metadata": {}
}
```

The endpoint stores the payload in an in-memory registry, timestamps it, logs the JSON body, and echoes it back to the caller. The catalog service will call this route for every publish event.

## ğŸ§ª Development Commands

```bash
pytest
ruff check src tests
black src tests
```

## ğŸ—‚ï¸ Project highlights

```
src/
â”œâ”€â”€ main.py              # FastAPI setup and routing
â”œâ”€â”€ config.py            # Environment + Qdrant settings
â”œâ”€â”€ models/product.py    # Pydantic schemas for incoming payloads
â””â”€â”€ services/
    â””â”€â”€ product_registry.py  # In-memory storage + dependency provider
```

`tests/` contains API-level tests that exercise the new registration flow.

## ğŸ§­ Demo client

A lightweight HTML/JS client lives under `../recommender-console/` (see repo root). Open `index.html` in a browser to trigger POST requests against the running service with pre-filled sample data.
